<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Agent Guide for R Package Development â€¢ rArimaOption</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Agent Guide for R Package Development"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">rArimaOption</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/pricing_methods.html">Pricing Methods</a></li>
    <li><a class="dropdown-item" href="articles/risk_neutral_pricing.html">Risk Neutral Pricing with ARIMA</a></li>
    <li><a class="dropdown-item" href="articles/risk_neutral_transformation.html">Risk Neutral Transformation</a></li>
    <li><a class="dropdown-item" href="articles/simulations.html">Simulating Stock Price Paths</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Agent Guide for R Package Development</h1>

    </div>

<div id="agent-guide-for-r-package-development" class="section level1">

<p>This document provides comprehensive guidelines for agents working on R package development projects using Nix, rix, and reproducible workflows.</p>
<div class="section level2">
<h2 id="id_1-quick-start-for-new-sessions">1. Quick Start for New Sessions<a class="anchor" aria-label="anchor" href="#id_1-quick-start-for-new-sessions"></a></h2>
<div class="section level3">
<h3 id="session-initialization-checklist">Session Initialization Checklist<a class="anchor" aria-label="anchor" href="#session-initialization-checklist"></a></h3>
<p>âœ… <strong>Environment:</strong> Verify youâ€™re in the nix shell (<code>caffeinate -i ~/docs_gh/rix.setup/default.sh</code>) âœ… <strong>Context:</strong> Read <code>.claude/CURRENT_WORK.md</code> if it exists âœ… <strong>State:</strong> Check <code>git status</code> and review recent commits âœ… <strong>Checkpoint:</strong> Review any <code>CLAUDE_CHECKPOINT.md</code> or session summary files âœ… <strong>Packages:</strong> Review installed vs.Â potential external R packages (CRAN/GitHub/R-universe)</p>
<p><strong>Package Review Protocol:</strong> At the start of each session, review the list of installed R packages. Identify potentially useful R packages available (CRAN, r-universe, GitHub) that are NOT already installed but might be relevant to project objectives (see <code>PLAN*.md</code> or GH issues). Highlight their pros and cons compared to the installed packages.</p>
</div>
</div>
<div class="section level2">
<h2 id="id_2-key-documentation-references">2. Key Documentation References<a class="anchor" aria-label="anchor" href="#id_2-key-documentation-references"></a></h2>
<p><strong>Core Guides:</strong> - <strong>Main Context:</strong> <code>context_claude.md</code> (This document) - <strong>9-Step Workflow:</strong> <a href="#id_4-the-9-step-mandatory-workflow">Section 4 below</a> (CRITICAL) - <strong>Environment QuickRef:</strong> <a href="./NIX_QUICKREF.html"><code>NIX_QUICKREF.md</code></a> (Fixes for top 5 issues)</p>
<p><strong>Wiki &amp; Detailed Guides:</strong> - <strong>Gemini CLI Guide:</strong> <a href="./WIKI_CONTENT/Gemini-CLI-Guide.html"><code>WIKI_CONTENT/Gemini-CLI-Guide.md</code></a> - <strong>Session Continuity:</strong> <a href="./WIKI_CONTENT/Session-Continuity.html"><code>WIKI_CONTENT/Session-Continuity.md</code></a> - <strong>Nix Generation:</strong> <a href="./WIKI_CONTENT/Environment-Sync-and-Nix-Generation.html"><code>WIKI_CONTENT/Environment-Sync-and-Nix-Generation.md</code></a> - <strong>Shinylive Lessons:</strong> <a href="./WIKI_SHINYLIVE_LESSONS_LEARNED.html"><code>WIKI_SHINYLIVE_LESSONS_LEARNED.md</code></a> - <strong>Targets &amp; Pkgdown:</strong> <a href="./TARGETS_PKGDOWN_OVERVIEW.html"><code>TARGETS_PKGDOWN_OVERVIEW.md</code></a></p>
<p><strong>Skills:</strong> - <strong>Nix Environment:</strong> <code>.claude/skills/nix-rix-r-environment/SKILL.md</code> - <strong>Workflow Skill:</strong> <code>.claude/skills/r-package-workflow/SKILL.md</code></p>
</div>
<div class="section level2">
<h2 id="id_3-critical-workflow-principles">3. Critical Workflow Principles<a class="anchor" aria-label="anchor" href="#id_3-critical-workflow-principles"></a></h2>
<p><strong>NEVER use bash git/gh commands</strong> - Always use R packages: - âœ… <code><a href="https://docs.ropensci.org/gert/reference/git_commit.html" class="external-link">gert::git_add()</a></code>, <code><a href="https://docs.ropensci.org/gert/reference/git_commit.html" class="external-link">gert::git_commit()</a></code>, <code><a href="https://docs.ropensci.org/gert/reference/git_fetch.html" class="external-link">gert::git_push()</a></code> - âœ… <code><a href="https://usethis.r-lib.org/reference/pull-requests.html" class="external-link">usethis::pr_init()</a></code>, <code><a href="https://usethis.r-lib.org/reference/pull-requests.html" class="external-link">usethis::pr_push()</a></code>, <code><a href="https://usethis.r-lib.org/reference/pull-requests.html" class="external-link">usethis::pr_merge_main()</a></code> - âœ… <code>gh::gh("POST /repos/...")</code> for GitHub API</p>
<p><strong>ALWAYS log commands</strong> - For reproducibility: - Create <code>R/setup/fix_issue_123.R</code> files documenting all R commands - Include log files IN the PR, not after merge (prevents duplicate CI/CD runs)</p>
<p><strong>ALWAYS work in Nix environment:</strong> - Use ONE persistent shell per session - Donâ€™t launch new shells for individual commands - See <a href="./archive/detailed-docs/NIX_TROUBLESHOOTING.html"><code>NIX_TROUBLESHOOTING.md</code></a> for environment degradation issues</p>
<p><strong>ALWAYS View Results via GitHub Pages:</strong> - All viewing of results must ultimately be through the deployed GitHub Pages website. - Supply URLs pointing to the various output webpages (vignettes, dashboards, etc.).</p>
</div>
<div class="section level2">
<h2 id="id_4-the-9-step-mandatory-workflow">4. The 9-Step Mandatory Workflow<a class="anchor" aria-label="anchor" href="#id_4-the-9-step-mandatory-workflow"></a></h2>
<p><strong>âš ï¸ CRITICAL: THIS IS NOT OPTIONAL - ALL CHANGES MUST FOLLOW THIS WORKFLOW âš ï¸</strong></p>
<p><strong>NO EXCEPTIONS. NO SHORTCUTS. NO â€œSIMPLE FIXESâ€.</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Create GitHub Issue (#123)                                 â”‚
â”‚ 2. Create dev branch (usethis::pr_init())                     â”‚
â”‚ 3. Make changes locally                                       â”‚
â”‚ 4. Run all checks (devtools::check(), etc.)                   â”‚
â”‚ 5. âš ï¸ MANDATORY: Push to johngavin cachix âš ï¸                   â”‚
â”‚    â””â”€â†’ nix-store ... | cachix push johngavin                  â”‚
â”‚ 6. Push to GitHub (usethis::pr_push())                        â”‚
â”‚ 7. Wait for GitHub Actions (pulls from cachix - fast!)        â”‚
â”‚ 8. Merge PR (usethis::pr_merge_main())                        â”‚
â”‚ 9. Log everything (R/setup/fix_issue_123.R)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<p><strong>Step Details:</strong></p>
<ol style="list-style-type: decimal"><li>
<strong>ğŸ“ Create GitHub Issue</strong>: Use <code>gh</code> package or GitHub website.</li>
<li>
<strong>ğŸŒ¿ Create Development Branch</strong>: <code>usethis::pr_init("fix-issue-123-description")</code>.</li>
<li>
<strong>âœï¸ Make Changes</strong>: Edit code on dev branch. Commit using <code>gert</code> (NOT bash).</li>
<li>
<strong>âœ… Run Checks</strong>: <code><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">devtools::document()</a></code>, <code>test()</code>, <code>check()</code>, <code><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">pkgdown::build_site()</a></code>. Fix ALL errors/notes.</li>
<li>
<strong>ğŸš€ Push to Cachix (MANDATORY)</strong>:
<ul><li>Run: <code>../push_to_cachix.sh</code> (or <code>nix-store ... | cachix push johngavin</code>)</li>
<li>
<strong>Why?</strong> GitHub Actions pulls from cachix. Saves time/resources. Ensures consistency.</li>
</ul></li>
<li>
<strong>ğŸš€ Push to Remote</strong>: <code><a href="https://usethis.r-lib.org/reference/pull-requests.html" class="external-link">usethis::pr_push()</a></code> (Only after cachix push succeeds).</li>
<li>
<strong>â³ Wait for GitHub Actions</strong>: Monitor all workflows. All must pass.</li>
<li>
<strong>ğŸ”€ Merge via PR</strong>: <code><a href="https://usethis.r-lib.org/reference/pull-requests.html" class="external-link">usethis::pr_merge_main()</a></code>, <code><a href="https://usethis.r-lib.org/reference/pull-requests.html" class="external-link">usethis::pr_finish()</a></code>.</li>
<li>
<strong>ğŸ“‹ Log Everything</strong>: Ensure session log (e.g., <code>R/setup/fix_issue_123.R</code>) was included in the PR.</li>
</ol><p><strong>Consequences of Skipping:</strong> If you commit directly to main or skip steps, you must create a retrospective issue and log file explaining the violation.</p>
<p><strong>Forbidden Commands:</strong> âŒ <code>git add .</code>, <code>git commit</code>, <code>git push</code> âŒ <code>gh pr create</code>, <code>gh issue create</code></p>
</div>
<div class="section level2">
<h2 id="id_5-nix-environment-management">5. Nix Environment Management<a class="anchor" aria-label="anchor" href="#id_5-nix-environment-management"></a></h2>
<p><strong>Detailed Guide:</strong> <a href="/Users/johngavin/docs_gh/rix.setup/NIX_PACKAGE_DEVELOPMENT.html"><code>NIX_PACKAGE_DEVELOPMENT.md</code></a> <strong>Quick Reference:</strong> <a href="./NIX_QUICKREF.html"><code>NIX_QUICKREF.md</code></a></p>
<p><strong>Quick Verification:</strong> ALWAYS verify youâ€™re running inside the nix shell:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$IN_NIX_SHELL</span>  <span class="co"># Should be 1 or impure</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">which</span> R             <span class="co"># Should be /nix/store/...</span></span></code></pre></div>
<p>If failed: <code>exit</code> and re-run <code>caffeinate -i ~/docs_gh/rix.setup/default.sh</code>.</p>
<p><strong>Generating Nix Files:</strong> We use a 3-file strategy (<code>package.nix</code>, <code>default.nix</code>, <code>packages.R</code>) managed by <code>R/setup/maintain_env.R</code>. See <a href="./WIKI_CONTENT/Environment-Sync-and-Nix-Generation.html"><code>WIKI_CONTENT/Environment-Sync-and-Nix-Generation.md</code></a> for details.</p>
<p>To update environment:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"R/setup/maintain_env.R"</span><span class="op">)</span></span>
<span><span class="fu">maintain_env</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_6-session-continuity">6. Session Continuity<a class="anchor" aria-label="anchor" href="#id_6-session-continuity"></a></h2>
<p><strong>Full Guide:</strong> <a href="./WIKI_CONTENT/Session-Continuity.html"><code>WIKI_CONTENT/Session-Continuity.md</code></a></p>
<p><strong>Key Principles:</strong> - <strong>Document Everything:</strong> Update <code>.claude/CURRENT_WORK.md</code> every 2-3 hours. - <strong>Git Checkpoints:</strong> Commit â€œWIPâ€ often. Use <code>git stash</code> if needed. - <strong>Restart Clean:</strong> Session history does not persist. Rely on files and logs.</p>
<p><strong>End-of-Session Checklist:</strong> 1. Commit/Stash work (<code>gert</code>). 2. Update <code>.claude/CURRENT_WORK.md</code>. 3. Push to remote. 4. Exit.</p>
</div>
<div class="section level2">
<h2 id="id_7-r-code-standards">7. R Code Standards<a class="anchor" aria-label="anchor" href="#id_7-r-code-standards"></a></h2>
<p><strong>Organization:</strong> - Organize code into an R package. - Prepare for R-Universe/CRAN submission.</p>
<p><strong>Style &amp; Docs:</strong> - Use <code>usethis::document()</code> and <code>test()</code>. - Use <code>logger</code> package for comments/logs. - Prefer tidyverse. - Use <code>air</code> for formatting (<code>air format ...</code>). - Use <code>typst</code> for formulas.</p>
<p><strong>File Structure:</strong> - <code>R/</code>: Package code. - <code>R/setup/</code>: Housekeeping, logs, bug fix scripts. - <code>R/tar_plans/</code>: Targets plans. - <code>inst/qmd/</code>: Source Quarto files (README, vignettes). - <code>inst/logs/</code>: Session logs.</p>
</div>
<div class="section level2">
<h2 id="id_8-targets-package">8. Targets Package<a class="anchor" aria-label="anchor" href="#id_8-targets-package"></a></h2>
<ul><li>
<strong>Pre-calculation:</strong> Use <code>targets</code> to precalculate vignette objects.</li>
<li>
<strong>Vignettes:</strong> Should rely on <code>targets::read()</code> or <code>targets::load()</code>. Minimize computation in .qmd.</li>
</ul></div>
<div class="section level2">
<h2 id="id_9-website-pkgdown--documentation">9. Website (pkgdown) &amp; Documentation<a class="anchor" aria-label="anchor" href="#id_9-website-pkgdown--documentation"></a></h2>
<p><strong>Standards:</strong> - Build site with <code>pkgdown</code>. - <strong>Hybrid Workflow:</strong> - Use Nix for R CMD Check &amp; Unit Tests. - Use Native R for pkgdown + Quarto (due to bslib incompatibility). - See <a href="./TARGETS_PKGDOWN_OVERVIEW.html"><code>TARGETS_PKGDOWN_OVERVIEW.md</code></a>. - <strong>Code Visibility:</strong> Hidden by default, toggleable.</p>
<p><strong>Infographics:</strong> - Create for major versions explaining package functionality. - Embed in README via targets.</p>
</div>
<div class="section level2">
<h2 id="id_10-special-topics">10. Special Topics<a class="anchor" aria-label="anchor" href="#id_10-special-topics"></a></h2>
<div class="section level3">
<h3 id="shinylive--dashboards">Shinylive &amp; Dashboards<a class="anchor" aria-label="anchor" href="#shinylive--dashboards"></a></h3>
<p><strong>Guide:</strong> <a href="./WIKI_SHINYLIVE_LESSONS_LEARNED.html"><code>WIKI_SHINYLIVE_LESSONS_LEARNED.md</code></a> - Use <code>resources: - shinylive-sw.js</code> in YAML. - Prefer <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> calls or <code>webr::install()</code> with custom repos. - Avoid <code>webr::mount()</code> from GitHub Releases (CORS issues). - <strong>Testing:</strong> Mandatory browser testing (Console check) per protocol.</p>
</div>
<div class="section level3">
<h3 id="gemini-cli-for-large-codebases">Gemini CLI for Large Codebases<a class="anchor" aria-label="anchor" href="#gemini-cli-for-large-codebases"></a></h3>
<p><strong>Guide:</strong> <a href="./WIKI_CONTENT/Gemini-CLI-Guide.html"><code>WIKI_CONTENT/Gemini-CLI-Guide.md</code></a> - Use <code>gemini -p</code> for large context analysis. - Use <code>@path</code> syntax to include files/directories.</p>
</div>
<div class="section level3">
<h3 id="telemetry">Telemetry<a class="anchor" aria-label="anchor" href="#telemetry"></a></h3>
<ul><li>Create <code>telemetry.qmd</code> vignette.</li>
<li>Visualize targets pipeline (<code>tar_viznetwork</code>).</li>
<li>Track compilation time, memory, git history.</li>
</ul></div>
<div class="section level3">
<h3 id="isolated-shell">Isolated Shell<a class="anchor" aria-label="anchor" href="#isolated-shell"></a></h3>
<ul><li>LLMs should run in <code>--pure</code> nix shell/container for security.</li>
<li>Limit write access.</li>
</ul></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by John Gavin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

